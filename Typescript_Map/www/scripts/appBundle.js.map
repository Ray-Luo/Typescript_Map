{"version":3,"file":"appBundle.js","sourceRoot":"","sources":["../../scripts/map.ts","../../scripts/index.ts","../../scripts/task.ts"],"names":[],"mappings":"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","sourcesContent":["﻿/// <reference path=\"jquery.d.ts\"/>\r\n/// <reference path=\"pouch.d.ts\"/>\r\n/// <reference path=\"typings/leaflet-draw/leaflet-draw.d.ts\"/>\r\n\r\nmodule Map\r\n{\r\n    \"use strict\";\r\n\r\n\r\n\r\n    export class Map\r\n    {\r\n\r\n        public static mymap;\r\n        public static _this;\r\n        private form: JQuery = $(\"#form\");\r\n        private submitButton: JQuery = $(\"#submit\");\r\n        public static db;\r\n        public static point_flag = 0;\r\n        public static line_flag = 1;\r\n        public static cursor_x;\r\n        public static cursor_y;\r\n        public static pt_list = [];\r\n        public static temp_polyline;\r\n        public static drawnItems;\r\n        public static JSONStringList = [];\r\n        public static featureID_autoincrement = 0;\r\n        public static task_title;\r\n        public static author;\r\n        public static drawControl;\r\n        public static new_task_btn: HTMLButtonElement = <HTMLButtonElement>document.querySelector('#new-task');;\r\n        public static edit_task_btn: HTMLButtonElement = <HTMLButtonElement>document.querySelector('#edit-task');\r\n        public static save_task_btn: HTMLButtonElement = <HTMLButtonElement>document.querySelector('#save-task');\r\n        public static delete_task_btn: HTMLButtonElement = <HTMLButtonElement>document.querySelector('#delete-task');\r\n        public static add_btn: HTMLButtonElement = <HTMLButtonElement>document.querySelector('#submit');\r\n\r\n\r\n        constructor(form: HTMLFormElement) {\r\n            Map._this = this;\r\n\r\n            Map.new_task_btn.addEventListener('click', function (e) {\r\n\r\n                Map.save_task_btn.disabled = false;\r\n\r\n                document.getElementById('abc').style.display = \"block\";\r\n                document.getElementById('content').style.display = \"none\";\r\n\r\n            });\r\n\r\n            Map.add_btn.addEventListener('click', function (e) {\r\n\r\n                Map.task_title = $(\"#title\").val();\r\n                Map.author = $(\"#author\").val();\r\n\r\n                document.getElementById('abc').style.display = \"none\";\r\n                document.getElementById('content').style.display = \"block\";\r\n\r\n                if (Map.drawnItems.length != 0) {\r\n                    if (Map.drawControl === undefined) {\r\n                        // enable edit\r\n                        Map.drawControl = new L.Control.Draw({\r\n                            draw: {\r\n                                polygon: true,\r\n                                polyline: true,\r\n                                rectangle: true,\r\n                                circle: true,\r\n                                marker: true,\r\n                            },\r\n                            edit: {\r\n                                featureGroup: Map.drawnItems\r\n                            }\r\n                        });\r\n\r\n                        Map.mymap.addControl(Map.drawControl);\r\n                    }\r\n                }\r\n            });\r\n\r\n            Map.save_task_btn.addEventListener('click', function (e) {\r\n                navigator.notification.confirm(\r\n                    'Click Yes to save \"' + Map.task_title + '\"',  // message\r\n                    saveTask,         // callback\r\n                    'Save this task?',            // title\r\n                    ['Yes', 'Cancel']                  // buttonName\r\n                );\r\n\r\n                //  save to db\r\n                function saveTask(): void {\r\n                    var db_entry = {\r\n                        _id: Map.task_title,\r\n                        author: Map.author,\r\n                        last_modified: new Date().toISOString(),\r\n                        JSONList: Map.JSONStringList\r\n                    };\r\n\r\n                    Map.db.put(db_entry).then(function () {\r\n                        Map.edit_task_btn.disabled = false;\r\n                        Map.delete_task_btn.disabled = false;\r\n                    }).catch(function (err) {\r\n                        if (err.name === 'conflict') {\r\n                            navigator.notification.alert(\r\n                                'There is an entry with title \"' + Map.task_title + '\" already exsiting in the database',  // message\r\n                                rename_title,         // callback\r\n                                'Title Conflict!',            // title\r\n                                'Done'                  // buttonName\r\n                            );\r\n                        } else {\r\n                            // some other error\r\n                        }\r\n                    });\r\n                }\r\n\r\n                //  Error handler for title conflict\r\n                function rename_title(): void {\r\n                    document.getElementById('abc').style.display = \"block\";\r\n                    document.getElementById('content').style.display = \"none\";\r\n                }\r\n\r\n            });\r\n\r\n            Map.edit_task_btn.addEventListener('click', function (e) {\r\n\r\n                if (Map.drawControl != null)\r\n                    Map.mymap.removeControl(Map.drawControl);  \r\n\r\n                if (Map.drawnItems.length != 0) {\r\n                    // enable edit\r\n                    Map.drawControl = new L.Control.Draw({\r\n                        draw: {\r\n                            polygon: false,\r\n                            polyline: true,\r\n                            rectangle: false,\r\n                            circle: false,\r\n                            marker: true,\r\n                        },\r\n                        edit: {\r\n                            featureGroup: Map.drawnItems\r\n                        }\r\n                    });\r\n\r\n                    Map.mymap.addControl(Map.drawControl);\r\n                }\r\n\r\n            });\r\n\r\n\r\n\r\n\r\n            this.initialize_map();\r\n\r\n            this.setup_puuchDB();\r\n\r\n\r\n        }\r\n                \r\n\r\n        initialize_map():void\r\n        {\r\n            $(\"h1\").css(\"font-size\", \"36px\");\r\n\r\n            Map.save_task_btn.disabled = true;\r\n\r\n            var edit_task_btn = document.querySelector('#edit-task');\r\n            var delete_task_btn = document.querySelector('#delete-task');\r\n            \r\n           //  Setting up leaflet map\r\n            Map.mymap = new L.Map('mapid', { editable:true}).setView([36,-96], 13);\r\n            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {\r\n                maxZoom: 18,\r\n                attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, ' +\r\n                '<a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ' +\r\n                'Imagery © <a href=\"http://mapbox.com\">Mapbox</a>',\r\n                id: 'mapbox.streets'\r\n            }).addTo(Map.mymap);\r\n     \r\n            //  Initilize a FeatureGroup which stores all layers in order to edit them\r\n            Map.drawnItems = new L.FeatureGroup();\r\n            Map.mymap.addLayer(Map.drawnItems);\r\n                               \r\n            //  Fired when start editting\r\n            Map.mymap.on('draw:created', function (e) {\r\n                var title,\r\n                    type = e.layerType,\r\n                    layer = e.layer,\r\n                    layerJSON,\r\n                    newFeature;\r\n\r\n                // add JSON string to the list\r\n                layer.title = Map.task_title + Map.featureID_autoincrement;\r\n                layerJSON = layer.toGeoJSON();\r\n                Map.JSONStringList.push(JSON.stringify(layerJSON));\r\n                \r\n                //  add layer to map\r\n                Map.drawnItems.addLayer(layer); \r\n                Map.mymap.addLayer(layer);\r\n            });\r\n\r\n\r\n            //  Fired when finished editting\r\n            Map.mymap.on('draw:edited', function (e) {\r\n                var shape;\r\n                var layers = e.layers;\r\n\r\n                layers.eachLayer(function (layer) {\r\n                    //do whatever you want, most likely save back to db\r\n                    var layerJSON = layer.toGeoJSON();\r\n\r\n                    Map.db.get(layer.title).then(function (doc) {\r\n                        return Map.db.put({\r\n                            _id: doc._id,\r\n                            _rev: doc._rev,\r\n                            jsonString: JSON.stringify(layerJSON)\r\n                        });\r\n                    }).then(function (response) {\r\n                        // handle response\r\n                    }).catch(function (err) {\r\n                        console.log(err);\r\n                    });\r\n                });\r\n            });\r\n\r\n\r\n            Map.mymap.on('draw:deleted', function (e) {\r\n                // Update db to save latest changes.\r\n\r\n            });\r\n\r\n            function onMapClick(e) {\r\n            }\r\n\r\n            Map.mymap.on('click', onMapClick);\r\n        }\r\n\r\n        setup_puuchDB(): void\r\n        {                      \r\n            Map.db = new PouchDB(\"LeveeInspection_1\");\r\n\r\n            {\r\n           /*\r\n            Map.db.destroy().then(function (response) {\r\n                // success\r\n            }).catch(function (err) {\r\n                console.log(err);\r\n            });   \r\n          */ }\r\n\r\n\r\n            //  Reading layers from db\r\n            Map.db.allDocs({ include_docs: true, descending: true }, function (err, result) {\r\n                var tasks = result.rows;\r\n\r\n                for (var i = 0; i < tasks.length; i++) {\r\n                    for (var j = 0; j < tasks[i].doc.JSONList.length; j++) {\r\n                        var json = JSON.parse(tasks[i].doc.JSONList[j]);\r\n                        var geoJSON = L.geoJson(json);\r\n                        var newLayer = geoJSON.getLayers()[0];\r\n                        Map.drawnItems.addLayer(newLayer);\r\n                    }\r\n                }\r\n                if (Map.drawnItems.length === 0) {\r\n                    Map.edit_task_btn.disabled = true;\r\n                    Map.delete_task_btn.disabled = true;\r\n                }\r\n            });\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    \r\n\r\n}","﻿// For an introduction to the Blank template, see the following documentation:\n// http://go.microsoft.com/fwlink/?LinkID=397705\n// To debug code on page load in Ripple or on Android devices/emulators: launch your app, set breakpoints, \n// and then run \"window.location.reload()\" in the JavaScript Console.\n\n/// <reference path=\"jquery.d.ts\"/>\n/// <reference path=\"map.ts\"/>\n\n\nmodule TypescriptMap {\n    \"use strict\";\n\n    export module Application {\n        export function initialize() {\n            document.addEventListener('deviceready', onDeviceReady, false);\n        }\n\n        function onDeviceReady() {\n            // Handle the Cordova pause and resume events\n            document.addEventListener('pause', onPause, false);\n            document.addEventListener('resume', onResume, false);\n\n            // TODO: Cordova has been loaded. Perform any initialization that requires Cordova here.\n            var parentElement = document.getElementById('deviceready');\n            var listeningElement = parentElement.querySelector('.listening');\n            var receivedElement = parentElement.querySelector('.received');\n            listeningElement.setAttribute('style', 'display:none;');\n            receivedElement.setAttribute('style', 'display:block;');\n\n\n            var map: Map.Map = new Map.Map(<HTMLFormElement>document.getElementById('form'));\n\n        }\n\n        function onPause() {\n            // TODO: This application has been suspended. Save application state here.\n        }\n\n        function onResume() {\n            // TODO: This application has been reactivated. Restore application state here.\n        }\n\n    }\n\n    window.onload = function () {\n        Application.initialize();\n    }\n}\n","﻿\r\n\r\nmodule Task {\r\n    \"use strict\";\r\n\r\n\r\n\r\n    export class Task {\r\n\r\n        name: String;\r\n        features = new L.FeatureGroup();\r\n        last_modified: String;\r\n        author: String;\r\n\r\n        constructor()\r\n        { }\r\n\r\n\r\n        addTask(name: String, author: String): void {\r\n\r\n\r\n            this.name = name;\r\n            this.author = author;\r\n        }\r\n\r\n        saveTask(): void {\r\n            //  Save to DB\r\n        }\r\n\r\n        editTask(): void {\r\n            //  Edit features on the map\r\n        }\r\n\r\n        deleteTask(): void {\r\n            //  delete DB entry\r\n        }\r\n    }\r\n\r\n}"]}